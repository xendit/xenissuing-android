name: Publish

on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  publish:
    name: Release build and publish
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2
        with:
          ref: main
          fetch-depth: '0'
      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          distribution: adopt
          java-version: 11
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew
      - name: Run Workflow
        uses: timheuer/base64-to-file@v1
        with:
          fileName: './secrets/secring.gpg'
          encodedString: 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

        # Builds the release artifacts of the library
      - name: Release build
        run: ./gradlew :xenissuing-android-lib:assembleRelease

        # Runs upload, and then closes & releases the repository
      - name: Publish to MavenCentral
        run: ./gradlew publishReleasePublicationToSonatypeRepository --max-workers 1 closeAndReleaseSonatypeStagingRepository
        env:
          OSSRH_USERNAME: xenditcards
          OSSRH_PASSWORD: nB6ykuv5yAlZHTrd5PCg\!
          SONATYPE_STAGING_PROFILE_ID: ff8dcadb0674f
